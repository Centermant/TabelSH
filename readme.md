# Система табельного учёта

Это веб-приложение для ведения и формирования табелей на основе рабочих активностей и телефонных консультаций. Проект реализован с использованием современного стека технологий: Fastify (Node.js) на бэкенде и чистый HTML/CSS/JS на фронтенде.

## Структура проекта
/web-nodejs-labs/
-    backend/ (Бэкенд-часть приложения)
-        src/
-            routes/ (API-эндпоинты – маршруты)
-            services/ (Бизнес-логика (сервисы))
-            server.js (Точка входа сервера)
-        package.json (Описание проекта с зависимостями)
-        .env (Файл конфигурации)
-    public/ (Фронтенд-часть приложения)
-        index.html (Главная страница (Авторизация))
-        app/ (Основная страница приложения после входа)
-            index.html (Главная страница Табельного учета)
-            admin.hrml (Админ панель)
-        css/ (Общие CSS-стили)
-        assets/ (Статические ресурсы: изображения, библиотеки и т.д.)
-        js/ (JavaScript-модули фронтенда)
-    Dockerfile (Инструкция по сборке Docker-образа)
-    docker-compose.yml (Файл для запуска контейнеров)
-    .gitignore


## Требования

- [Docker](https://www.docker.com/) и [Docker Compose](https://docs.docker.com/compose/)

## Установка и запуск

1.  **Клонируйте репозиторий**:
    ```bash
    git clone https://github.com/Centermant/TabelSH.git
    cd web-nodejs-labs
    ```

2.  **Создайте файл `.env`** в /backend директории проекта со следующим содержимым:
    ```ini
    DATABASE_URL=postgres://devuser:devpass@db:5432/timesheetdb
    SECRET_KEY=your_secret_key_for_jwt_here
    APP_URL=http://localhost:3000
    ```

3.  **Запустите приложение с помощью Docker Compose**:
    ```bash
    docker-compose up -d --build
    ```

4.  **Приложение будет доступно по адресу**: `http://localhost:3000`.

## Инициализация базы данных

Для работы приложения необходимо создать и заполнить таблицы в базе данных PostgreSQL.

1.  Откройте **Adminer** по адресу: `http://localhost:8080`.
    -   Система: `PostgreSQL`
    -   Сервер: `db`
    -   Имя пользователя: `devuser`
    -   Пароль: `devpass`
    -   База данных: `timesheetdb`

2.  Перейдите на вкладку **"SQL запрос"**.

3.  **Вставьте SQL-скрипт** из файла [`bd.txt`](bd.txt), который находится в корне этого репозитория.

    **Важно!** В оригинальном экспорте Adminer есть ошибка в определении таблицы `users`. При экспорте данных из Adminer убедитесь, что строка с полем `applications` выглядит **именно так**:

    ```sql
    "applications" text[] DEFAULT '{timesheet}'::text[],
    ```

    А не так, как в некоторых экспортах Adminer:
    ```sql
    -- НЕПРАВИЛЬНО!
    "applications" text[] DEFAULT 'ARRAY[''timesheet''',
    ```

4.  Нажмите **"Выполнить"**, чтобы применить скрипт и создать все необходимые таблицы и данные.

## Авторизация

По умолчанию в базе данных созданы не созданы пользователи, их нужно создать в Adminer:
```sql
INSERT INTO "users" ("id", "login", "password", "role", "applications") VALUES
(1,'Ваш_Логин','Ваш_Пароль','admin','{admin,timesheet}'),
```

После успешного входа вы попадёте в панель управления табельным учётом или в панель администратора, в зависимости от выбранного приложения.

## Функционал

Приложение позволяет:
-   Управлять справочниками: **Организации** и **Сотрудники организаций**.
-   Вести журнал **Рабочей активности** и **Телефонных консультаций**.
-   Формировать и просматривать **Табель** за любой период.
-   Генерировать отчёты в формате Excel:
    -   **Отчёт Табель Общий**.
    -   **Отчёт табель по клиентам**.

## Остановка приложения

Для остановки всех контейнеров выполните команду:
```bash
docker-compose down